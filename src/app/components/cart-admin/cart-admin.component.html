<div
  class="flex flex-col h-screen px-2 xl:px-3 border-r-[1px] border-slate-300"
>
  <div
    class="py-2 md:py-4 w-full flex items-center justify-between bg-transparent"
  >
    <div class="w-full">
      <p class="font-bold text-lg">Detail Pesanan</p>
    </div>
    <button
      class="shadow-sm shrink-0 mr-[42px] md:mr-0 rounded-full flex justify-center items-center h-9 w-9 cursor-pointer"
    >
      <ng-icon name="bootstrapThreeDots" />
    </button>
  </div>

  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-4">
    <div class="xl:flex items-center space-y-4 xl:space-y-0 xl:space-x-3">
      <p-floatlabel variant="on" class="w-full">
        <input
          type="text"
          pInputText
          id="customerName"
          class="w-full"
          pKeyFilter="alpha"
          formControlName="customerName"
        />
        <label for="customerName">Nama</label>
      </p-floatlabel>
      <p-floatlabel variant="on" class="w-full">
        <input
          type="text"
          pInputText
          id="customerPhone"
          class="w-full"
          pKeyFilter="num"
          formControlName="customerPhone"
        />
        <label for="customerPhone">Phone</label>
      </p-floatlabel>
    </div>
    <p-select
      [options]="tables"
      formControlName="selectedTable"
      optionLabel="name"
      [filter]="true"
      filterBy="name"
      [showClear]="true"
      placeholder="Pilih Meja"
      class="w-full"
    >
      <ng-template pTemplate="selectedItem" let-selectedOption>
        <div class="flex items-center gap-2">
          <div>{{ selectedOption.name }}</div>
        </div>
      </ng-template>
    </p-select>
  </form>

  <ng-container *ngIf="cartState$ | async as state">
    <div
      class="mt-1 h-[calc(100vh - 250px)] overflow-auto pt-3 pl-1 pr-3 md:pr-1 xl:pr-2 small-scrollbar"
    >
      <!-- Loading State -->
      <ng-container *ngIf="state.loading">
        <div class="flex flex-col gap-4">
          <div
            *ngFor="let i of [1, 2]"
            class="flex items-center gap-y-4 gap-x-3 mb-2 md:mb-3 p-3 shadow-sm rounded md:rounded-lg bg-white"
          >
            <div
              class="h-10 w-10 lg:h-20 lg:w-20 bg-gray-300 rounded animate-pulse"
            ></div>
            <div class="flex-1 flex flex-col gap-1">
              <span
                class="inline-block h-5 w-3/4 bg-gray-300 rounded animate-pulse"
              ></span>
              <div class="flex justify-between">
                <span
                  class="inline-block h-5 w-16 bg-gray-300 rounded animate-pulse"
                ></span>
                <span
                  class="inline-block h-5 w-8 bg-gray-300 rounded animate-pulse"
                ></span>
              </div>
            </div>
          </div>
        </div>
      </ng-container>

      <!-- Empty State -->
      <ng-container
        *ngIf="
          !state.loading && (!state.cart || !state.cart.billRequest?.length)
        "
      >
        <div
          class="text-center py-10 flex space-x-2 justify-center items-center"
        >
          <ng-icon name="bootstrapInfoCircle" />
          <p class="text-gray-500 italic">Belum ada pesanan</p>
        </div>
      </ng-container>

      <!-- Cart Items -->
      <ng-container *ngIf="!state.loading && state.cart?.billRequest?.length">
        <ng-container
          *ngFor="let item of state.cart?.billRequest; trackBy: trackById"
        >
          <div
            class="flex items-center gap-y-4 gap-x-3 mb-2 md:mb-3 p-3 shadow-sm rounded md:rounded-lg bg-white"
          >
            <!-- Placeholder untuk gambar -->
            <ng-container *ngIf="!item.id; else imageTemplate">
              <div
                class="h-10 w-10 lg:h-20 lg:w-20 bg-gray-300 rounded animate-pulse"
              ></div>
            </ng-container>
            <ng-template #imageTemplate>
              <img
                [src]="createImgUrl(item.image?.id)"
                [alt]="item.name || 'Item'"
                class="hidden xl:block h-16 w-16 lg:h-20 lg:w-20 object-contain bg-amber-100 rounded-lg"
              />
            </ng-template>

            <ng-container *ngIf="item.id; else loadingPrice">
              <div class="flex-1 space-y-1">
                <p class="font-medium text-sm line-clamp-1 xl:text-md">
                  {{ item.name }}
                </p>
                <div class="flex justify-between">
                  <p class="text-sm xl:text-lg font-bold">
                    Rp. {{ item.price | number: "1.0-0" }}
                  </p>
                  <p class="text-sm text-gray-600 font-semibold shrink-0">
                    x {{ item.qty }}
                  </p>
                </div>
                <div class="flex justify-between items-center">
                  <p-inputnumber
                    [(ngModel)]="item.qty"
                    (ngModelChange)="updateQuantity(item.id, $event)"
                    min="1"
                    max="100"
                    [showButtons]="true"
                    buttonLayout="horizontal"
                    spinnerMode="horizontal"
                    inputId="horizontal"
                    [inputStyle]="{ width: '3rem', padding: '3px' }"
                    size="small"
                  >
                    <ng-template #incrementbuttonicon>
                      <span class="pi pi-plus" style="font-size: 10px"></span>
                    </ng-template>
                    <ng-template #decrementbuttonicon>
                      <span class="pi pi-minus" style="font-size: 10px"></span>
                    </ng-template>
                  </p-inputnumber>
                  <p-button
                    (click)="deleteByMenuId(item.id)"
                    icon="pi pi-trash"
                    size="small"
                    [style]="{
                      padding: '3px',
                      backgroundColor: 'white',
                      color: 'red',
                    }"
                  />
                </div>
              </div>
            </ng-container>

            <ng-template #loadingPrice>
              <div class="flex-1 flex flex-col gap-1">
                <span
                  class="inline-block h-5 w-3/4 bg-gray-300 rounded animate-pulse"
                ></span>
                <div class="flex justify-between">
                  <span
                    class="inline-block h-5 w-16 bg-gray-300 rounded animate-pulse"
                  ></span>
                  <span
                    class="inline-block h-5 w-8 bg-gray-300 rounded animate-pulse"
                  ></span>
                </div>
              </div>
            </ng-template>
          </div>
        </ng-container>
      </ng-container>
    </div>
    <div class="pl-1 pr-2">
      <app-cart-summary [state]="state" [isShow]="false" />
    </div>
  </ng-container>
</div>
